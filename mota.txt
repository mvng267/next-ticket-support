üß© T·ªïng quan ch·ª©c nƒÉng

·ª®ng d·ª•ng ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n n·ªÅn t·∫£ng Next.js (App Router), ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt backend x·ª≠ l√Ω ƒë·ªìng b·ªô d·ªØ li·ªáu t·ª´ HubSpot th√¥ng qua API, l∆∞u tr·ªØ d·ªØ li·ªáu v·ªÅ ticket v√†o Firestore (c∆° s·ªü d·ªØ li·ªáu Realtime c·ªßa Firebase). Ngo√†i ra, m·ªôt ph·∫ßn frontend ƒë∆°n gi·∫£n s·∫Ω s·ª≠ d·ª•ng payload (d·ªØ li·ªáu ƒëi·ªÅu khi·ªÉn) t·ª´ ng∆∞·ªùi d√πng ƒë·ªÉ g·ªçi c√°c ch·ª©c nƒÉng x·ª≠ l√Ω t∆∞∆°ng ·ª©ng tr√™n backend.

‚∏ª

‚öôÔ∏è C√°c th√†nh ph·∫ßn ch√≠nh

1. Frontend (Payload Controller)
	‚Ä¢	Giao di·ªán ng∆∞·ªùi d√πng ƒë∆°n gi·∫£n c√≥ n√∫t b·∫•m Sync Tickets.
	‚Ä¢	Khi ng∆∞·ªùi d√πng b·∫•m n√∫t, payload c√≥ d·∫°ng { trigger: 'sync' } ƒë∆∞·ª£c g·ª≠i t·ªõi API backend.
	‚Ä¢	Payload ƒë√≥ng vai tr√≤ x√°c ƒë·ªãnh h√†nh ƒë·ªông c·∫ßn th·ª±c hi·ªán (·ªü ƒë√¢y l√† "sync").

2. Backend API (Next.js API Routes)
	‚Ä¢	Nh·∫≠n payload t·ª´ frontend.
	‚Ä¢	Ki·ªÉm tra gi√° tr·ªã payload, n·∫øu l√† "sync" th√¨ th·ª±c hi·ªán g·ªçi API c·ªßa HubSpot ƒë·ªÉ l·∫•y danh s√°ch tickets.
	‚Ä¢	Sau khi nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu, l∆∞u c√°c ticket v√†o Firestore.

3. HubSpot API Integration
	‚Ä¢	S·ª≠ d·ª•ng Bearer Token t·ª´ bi·∫øn m√¥i tr∆∞·ªùng .env.local ƒë·ªÉ g·ªçi HubSpot API.
	‚Ä¢	Endpoint ƒë∆∞·ª£c s·ª≠ d·ª•ng: https://api.hubapi.com/crm/v3/objects/tickets
	‚Ä¢	D·ªØ li·ªáu tr·∫£ v·ªÅ g·ªìm th√¥ng tin ticket nh∆∞ ID, subject, priority, status‚Ä¶

4. Firebase Firestore
	‚Ä¢	K·∫øt n·ªëi t·ªõi Firestore qua SDK c·ªßa Firebase.
	‚Ä¢	L∆∞u t·ª´ng ticket v√†o collection t√™n l√† tickets, v·ªõi key l√† ID ticket t·ª´ HubSpot.

‚∏ª

üìÇ C·∫•u tr√∫c th∆∞ m·ª•c

my-hubspot-app/
‚îú‚îÄ‚îÄ app/                    ‚Üí Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            ‚Üí Trang ch√≠nh (hi·ªÉn th·ªã n√∫t Sync)
‚îÇ   ‚îî‚îÄ‚îÄ api/hubspot/sync.ts ‚Üí API route x·ª≠ l√Ω ƒë·ªìng b·ªô
‚îú‚îÄ‚îÄ components/             ‚Üí Component React
‚îÇ   ‚îî‚îÄ‚îÄ PayloadControls.tsx ‚Üí N√∫t ƒëi·ªÅu khi·ªÉn g·ª≠i payload
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ hubspot.ts          ‚Üí G·ªçi API t·ª´ HubSpot
‚îÇ   ‚îî‚îÄ‚îÄ firestore.ts        ‚Üí L∆∞u d·ªØ li·ªáu v√†o Firestore
‚îú‚îÄ‚îÄ types/                  ‚Üí ƒê·ªãnh nghƒ©a ki·ªÉu d·ªØ li·ªáu
‚îú‚îÄ‚îÄ firebase.ts             ‚Üí Kh·ªüi t·∫°o Firebase
‚îú‚îÄ‚îÄ .env.local              ‚Üí Bi·∫øn m√¥i tr∆∞·ªùng
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ next.config.js


‚Ä¢	M·ªçi th√¥ng tin nh·∫°y c·∫£m nh∆∞ HubSpot API Key, Firebase API Key, Project ID‚Ä¶ ƒë∆∞·ª£c l∆∞u tr·ªØ trong file .env.local v√† kh√¥ng ƒë∆∞·ª£c ƒë·∫©y l√™n GitHub.
‚Ä¢	·ª®ng d·ª•ng s·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng theo chu·∫©n Next.js ƒë·ªÉ b·∫£o v·ªá th√¥ng tin truy c·∫≠p.



D·ªÖ d√†ng m·ªü r·ªông th√™m c√°c thao t√°c backend theo payload.
T√°ch bi·ªát r√µ frontend (g·ª≠i payload) v√† backend (x·ª≠ l√Ω ch·ª©c nƒÉng).
Kh√¥ng c·∫ßn server ri√™ng, c√≥ th·ªÉ deploy l√™n Vercel ho·∫∑c Firebase Hosting. 


*L∆∞u √Ω nh·ªØng th√¥ng tin ticket c·∫ßn l·∫•y t·ª´ HubSpot 
- hs_ticket_id -> d·ªØ li·ªáu l√† ID ticket
- hs_ticket_category -> l·∫•y "value" c·ªßa hs_ticket_category
- hubspot_owner_id -> l·∫•y "value"  c·ªßa hubspot_owner_id, ƒë√≥ l√† ID user h√£y t√¨m ki·∫øm b·∫±ng ID v√† l·∫•y ra t√™n ng∆∞·ªùi t·∫°o
- hs_primary_company_name -> l·∫•y value c·ªßa hs_primary_company_name
- subject -> l·∫•y value c·ªßa subject
- source_type -> l·∫•y value c·ªßa source_type
- content -> l·∫•y value c·ªßa content
- hs_pipeline_stage >>> hs_pipeline_stage l·∫•y value
- support_object -> l·∫•y value (ch·ªó n√†y ch·∫Øc c·∫ßn ph·∫£i c√≥ 1 c√°i api ƒë·ªÉ l·∫•y ƒëc lable)
- hs_ticket_category -> l·∫•y value v√† lable c·ªßa hs_ticket_category ƒë·ªëi chi·∫øu l·∫°i ƒë·ªÉ l·∫•y ƒë∆∞·ª£c data lable
- create date -> l·∫•y d·ªØ li·ªáu ng√†y, gi·ªù t·∫°o


s·ª≠ d·ª•ng API
https://api.hubapi.com/crm/v3/objects/tickets/search