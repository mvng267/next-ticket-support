1. Giá»›i thiá»‡u há»‡ thá»‘ng

Há»‡ thá»‘ng cho phÃ©p Ä‘á»“ng bá»™ dá»¯ liá»‡u ticket tá»« HubSpot thÃ´ng qua API, lÆ°u trá»¯ vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u PostgreSQL, hiá»ƒn thá»‹ vÃ  quáº£n lÃ½ thÃ´ng tin ticket, vÃ  táº¡o bÃ¡o cÃ¡o thÃ´ng minh sá»­ dá»¥ng AI (Gemini) theo ngÃ y/tuáº§n/thÃ¡ng. á»¨ng dá»¥ng Ä‘Æ°á»£c triá»ƒn khai trÃªn ná»n Next.js + Prisma ORM + PostgreSQL, dÃ¹ng Tailwind CSS + DaisyUI cho giao diá»‡n, vÃ  host trÃªn Vercel.

â¸»

2. Kiáº¿n trÃºc cÃ´ng nghá»‡

ThÃ nh pháº§n	CÃ´ng nghá»‡ sá»­ dá»¥ng
Frontend	Next.js (App Router), Tailwind CSS, DaisyUI
Backend	API Route (Next.js), Prisma ORM
CÆ¡ sá»Ÿ dá»¯ liá»‡u	PostgreSQL (qua Prisma)
AI xá»­ lÃ½ bÃ¡o cÃ¡o	Gemini API (Google Generative AI)
Deploy	Vercel
CI/CD	Vercel build optimization, mÃ´i trÆ°á»ng .env.local


â¸»

3. Chá»©c nÄƒng chÃ­nh

ğŸ§© 3.1 Äá»“ng bá»™ ticket tá»« HubSpot
	â€¢	Dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘á»“ng bá»™ thÃ´ng qua HubSpot API /crm/v3/objects/tickets/search.
	â€¢	CÃ³ thá»ƒ lá»±a chá»n Ä‘á»“ng bá»™ theo:
	â€¢	1 ngÃ y trÆ°á»›c
	â€¢	7 ngÃ y trÆ°á»›c
	â€¢	30 ngÃ y trÆ°á»›c
	â€¢	6 thÃ¡ng trÆ°á»›c
	â€¢	CÃ¡c trÆ°á»ng cáº§n láº¥y vÃ  xá»­ lÃ½:

TrÆ°á»ng	Ghi chÃº xá»­ lÃ½
hs_ticket_id	LÃ  id, dÃ¹ng lÃ m khÃ³a chÃ­nh
hs_ticket_category	Láº¥y value vÃ  label tá»« API metadata
hubspot_owner_id	Láº¥y value, gá»i API Ä‘á»ƒ láº¥y tÃªn
hs_primary_company_name	Láº¥y value
subject	Láº¥y value
source_type	Láº¥y value
content	Láº¥y value
hs_pipeline_stage	Gá»i pipeline API Ä‘á»ƒ láº¥y label
support_object	Láº¥y label tá»« metadata
createDate	NgÃ y giá» táº¡o, lÆ°u Ä‘á»‹nh dáº¡ng ISO UTC

TrÆ°á»›c khi insert/update vÃ o DB, cáº§n kiá»ƒm tra hs_ticket_id Ä‘Ã£ tá»“n táº¡i chÆ°a Ä‘á»ƒ trÃ¡nh trÃ¹ng.

â¸»

ğŸ—ƒ 3.2 CÆ¡ sá»Ÿ dá»¯ liá»‡u PostgreSQL (qua Prisma)

Báº£ng tickets
	â€¢	LÆ°u toÃ n bá»™ thÃ´ng tin ticket (1 báº£n ghi/ticket)
	â€¢	id = hs_ticket_id (string) lÃ  khÃ³a chÃ­nh
	â€¢	CÃ³ cÃ¡c trÆ°á»ng: subject, content, owner, company, createDate, category, pipelineStage, sourceType, â€¦

Báº£ng report
	â€¢	LÆ°u bÃ¡o cÃ¡o táº¡o tá»« AI
	â€¢	TrÆ°á»ng:
	â€¢	id: UUID
	â€¢	ticket_ids: JSON[]
	â€¢	content: Káº¿t quáº£ tráº£ vá» tá»« Gemini
	â€¢	start_date, end_date: ngÃ y lá»c ticket
	â€¢	created_at: thá»i Ä‘iá»ƒm táº¡o bÃ¡o cÃ¡o
	â€¢	prompt: prompt sá»­ dá»¥ng Ä‘á»ƒ sinh bÃ¡o cÃ¡o
	â€¢	type: bÃ¡o cÃ¡o ngÃ y/tuáº§n/thÃ¡ng (day, week, month)

Báº£ng prompt
	â€¢	Máº«u prompt dÃ¹ng Ä‘á»ƒ sinh bÃ¡o cÃ¡o:
	â€¢	id: day, week, month
	â€¢	prompt: ná»™i dung máº«u

â¸»

ğŸ–¥ 3.3 Giao diá»‡n ngÆ°á»i dÃ¹ng

Trang Home
	â€¢	Hiá»ƒn thá»‹ cÃ¡c chá»©c nÄƒng test:
	â€¢	Test káº¿t ná»‘i database
	â€¢	Test API log
	â€¢	Test lá»—i Ä‘á»“ng bá»™

Trang Sync
	â€¢	CÃ³ cÃ¡c nÃºt Ä‘á»“ng bá»™ theo thá»i gian:
	â€¢	6 thÃ¡ng / 1 thÃ¡ng / 15 ngÃ y / 7 ngÃ y / 1 ngÃ y
	â€¢	Gá»i backend Ä‘á»ƒ fetch vÃ  ghi dá»¯ liá»‡u vÃ o DB (báº£ng tickets)
	â€¢	DÃ¹ng Tailwind + DaisyUI button group

Trang Quáº£n lÃ½ Ticket
	â€¢	Hiá»ƒn thá»‹ toÃ n bá»™ danh sÃ¡ch ticket tá»« DB (báº£ng tickets)
	â€¢	TÃ­nh nÄƒng:
	â€¢	Lá»c theo ngÃ y báº¯t Ä‘áº§u, ngÃ y káº¿t thÃºc
	â€¢	PhÃ¢n trang káº¿t quáº£
	â€¢	Modal chi tiáº¿t ticket khi báº¥m vÃ o dÃ²ng dá»¯ liá»‡u

Trang BÃ¡o CÃ¡o AI
	â€¢	Chá»n loáº¡i bÃ¡o cÃ¡o:
	â€¢	NÃºt: BÃ¡o cÃ¡o theo ngÃ y | BÃ¡o cÃ¡o theo tuáº§n | BÃ¡o cÃ¡o theo thÃ¡ng
	â€¢	Má»—i nÃºt gáº¯n vá»›i má»™t prompt máº«u (tá»« báº£ng prompt)
	â€¢	CÃ³ Ã´ textarea Ä‘á»ƒ nháº­p prompt tÃ¹y chá»‰nh
	â€¢	Káº¿t quáº£ bÃ¡o cÃ¡o tráº£ vá» tá»« Gemini, hiá»ƒn thá»‹ dÆ°á»›i dáº¡ng markdown Ä‘Æ°á»£c render Ä‘áº¹p
	â€¢	NÃºt â€œViáº¿t bÃ¡o cÃ¡oâ€ thá»±c hiá»‡n:
	â€¢	Gá»­i ticket[] lá»c theo thá»i gian + prompt â†’ Gemini
	â€¢	Hiá»ƒn thá»‹ káº¿t quáº£ á»Ÿ khu vá»±c káº¿t quáº£
	â€¢	LÆ°u vÃ o báº£ng report

â¸»

4. API & xá»­ lÃ½ backend

API Endpoint	PhÆ°Æ¡ng thá»©c	MÃ´ táº£ chá»©c nÄƒng
/api/hubspot/sync	POST	Nháº­n { range }, gá»i HubSpot API, lÆ°u ticket vÃ o DB
/api/tickets	GET	Tráº£ danh sÃ¡ch ticket cÃ³ phÃ¢n trang + filter ngÃ y
/api/tickets/[id]	GET	Tráº£ chi tiáº¿t 1 ticket
/api/reports	POST	Sinh bÃ¡o cÃ¡o AI tá»« danh sÃ¡ch ticket + prompt
/api/prompts/[type]	GET	Tráº£ prompt máº«u theo day/week/month


â¸»

5. Xá»­ lÃ½ AI bÃ¡o cÃ¡o (Gemini)
	â€¢	Dá»¯ liá»‡u input:
	â€¢	Danh sÃ¡ch ticket (lá»c theo ngÃ y táº¡o)
	â€¢	Prompt máº«u hoáº·c tuá»³ chá»‰nh tá»« ngÆ°á»i dÃ¹ng
	â€¢	Tráº£ vá» bÃ¡o cÃ¡o dáº¡ng markdown, hiá»ƒn thá»‹ káº¿t quáº£ trÃªn frontend
	â€¢	Gá»£i Ã½ prompt tiáº¿ng Viá»‡t máº«u:

HÃ£y Ä‘á»c danh sÃ¡ch cÃ¡c ticket sau vÃ  tÃ³m táº¯t ngáº¯n gá»n nhá»¯ng váº¥n Ä‘á» tá»“n Ä‘á»ng, nhÃ³m theo ná»™i dung chÃ­nh. Viáº¿t báº±ng tiáº¿ng Viá»‡t, rÃµ rÃ ng, sÃºc tÃ­ch, cáº¥u trÃºc dá»… Ä‘á»c, cÃ³ Ä‘Ã¡nh sá»‘ má»¥c náº¿u cáº§n.


â¸»

6. Báº£o máº­t vÃ  mÃ´i trÆ°á»ng
	â€¢	Biáº¿n mÃ´i trÆ°á»ng .env.local lÆ°u:
	â€¢	HUBSPOT_API_KEY
	â€¢	DATABASE_URL (PostgreSQL)
	â€¢	GEMINI_API_KEY
	â€¢	KhÃ´ng Ä‘áº©y .env.local lÃªn Git
	â€¢	DÃ¹ng process.env Ä‘á»ƒ gá»i biáº¿n mÃ´i trÆ°á»ng trong code

â¸»

7. Deploy
	â€¢	Ná»n táº£ng: Vercel (Next.js SSR + Edge-ready)
	â€¢	Database: PostgreSQL trÃªn Supabase, Railway hoáº·c Neon
	â€¢	Gemini AI dÃ¹ng qua API Key

â¸»

8. YÃªu cáº§u ká»¹ thuáº­t khÃ¡c
	â€¢	UI sá»­ dá»¥ng Tailwind CSS + DaisyUI
	â€¢	DÃ¹ng Prisma ORM cho toÃ n bá»™ truy váº¥n
	â€¢	Code backend chuáº©n hÃ³a cho API route
	â€¢	Tá»‘i Æ°u build & deploy cho Vercel:
	â€¢	KhÃ´ng dÃ¹ng SQLite
	â€¢	DÃ¹ng Prisma generate lÃºc build
	â€¢	KhÃ´ng cÃ³ server state

â¸»

DÆ°á»›i Ä‘Ã¢y lÃ  pháº§n bá»• sung cho tÃ i liá»‡u SRS cá»§a há»‡ thá»‘ng, má»Ÿ rá»™ng chá»©c nÄƒng tá»± Ä‘á»™ng Ä‘á»“ng bá»™ ticket vÃ  táº¡o/gá»­i bÃ¡o cÃ¡o theo lá»‹ch (cronjob).

â¸»

â° 9. Tá»± Ä‘á»™ng hÃ³a báº±ng Cronjob

ğŸ¯ Má»¥c tiÃªu:
	â€¢	Tá»± Ä‘á»™ng cháº¡y cÃ¡c tÃ¡c vá»¥:
	1.	Äá»“ng bá»™ ticket má»›i nháº¥t tá»« HubSpot
	2.	Sinh bÃ¡o cÃ¡o AI Ä‘á»‹nh ká»³ (ngÃ y / tuáº§n / thÃ¡ng)
	3.	Gá»­i káº¿t quáº£ bÃ¡o cÃ¡o qua API Ä‘áº¿n há»‡ thá»‘ng ngoÃ i (náº¿u cáº§n)

â¸»

ğŸ”§ CÃ´ng nghá»‡ sá»­ dá»¥ng:

TÃ¡c vá»¥	CÃ´ng cá»¥ cron Ä‘á» xuáº¥t
LÃªn lá»‹ch cháº¡y tÃ¡c vá»¥ serverless	vercel-cron (cho Vercel)
Cá»¥c bá»™ hoáº·c server riÃªng	node-cron, cron, hoáº·c Supabase Edge Functions


â¸»

âœ… CÃ¡c tÃ¡c vá»¥ tá»± Ä‘á»™ng

ğŸŸ¡ 9.1 Äá»“ng bá»™ ticket theo lá»‹ch

TÃ¡c vá»¥	Lá»‹ch	Endpoint gá»i	Ghi chÃº
Äá»“ng bá»™ ticket hÃ ng ngÃ y	03:00 sÃ¡ng má»—i ngÃ y	/api/hubspot/sync?range=1d	Cháº¡y 1 láº§n/ngÃ y
Äá»“ng bá»™ ticket hÃ ng tuáº§n	Chá»§ nháº­t 03:00	/api/hubspot/sync?range=7d	Tuáº§n/láº§n

â¡ï¸ Cronjob sáº½ gá»i cÃ¡c route backend Next.js nhÆ° má»™t HTTP request.

â¸»

ğŸŸ¢ 9.2 Táº¡o bÃ¡o cÃ¡o AI theo lá»‹ch

Loáº¡i bÃ¡o cÃ¡o	Lá»‹ch cháº¡y	Endpoint	Ghi chÃº
BÃ¡o cÃ¡o ngÃ y	Má»—i ngÃ y lÃºc 04:00	/api/reports/cron?type=day	Gá»­i prompt máº«u day, lÆ°u káº¿t quáº£
BÃ¡o cÃ¡o tuáº§n	Má»—i tuáº§n lÃºc 04:30 T7	/api/reports/cron?type=week	Gá»­i prompt máº«u week
BÃ¡o cÃ¡o thÃ¡ng	1 thÃ¡ng/lÃºc 05:00 ngÃ y 1	/api/reports/cron?type=month	Gá»­i prompt máº«u month


â¸»

ğŸ“¡ 9.3 Gá»­i bÃ¡o cÃ¡o qua API ngoÃ i (Webhook)
	â€¢	Sau khi bÃ¡o cÃ¡o Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng:
	â€¢	Tá»± Ä‘á»™ng POST ná»™i dung (markdown hoáº·c JSON) tá»›i 1 Ä‘á»‹a chá»‰ API cáº¥u hÃ¬nh sáºµn.
	â€¢	Cáº¥u hÃ¬nh Webhook trong .env hoáº·c báº£ng settings.

POST https://api.external-system.com/receive-report
{
  "type": "day",
  "from": "2025-07-09T00:00:00Z",
  "to": "2025-07-09T23:59:59Z",
  "report": "<markdown content>"
}


â¸»

ğŸ›  Máº«u Ä‘á»‹nh nghÄ©a cron job trÃªn Vercel

{
  "cron": [
    {
      "path": "/api/hubspot/sync?range=1d",
      "schedule": "0 3 * * *"
    },
    {
      "path": "/api/reports/cron?type=day",
      "schedule": "0 4 * * *"
    }
  ]
}

â†’ File nÃ y nÃªn Ä‘áº·t táº¡i: vercel.json

â¸»

âœï¸ Má»Ÿ rá»™ng SRS â€“ Má»¥c 9: TÃ¡c vá»¥ Ä‘á»‹nh ká»³ (Cron)

â• ThÃªm cÃ¡c API backend:

Endpoint	Method	MÃ´ táº£
/api/reports/cron?type=...	POST hoáº·c GET	Táº¡o bÃ¡o cÃ¡o Ä‘á»‹nh ká»³ theo type day, week, month
/api/hubspot/sync?range=...	POST hoáº·c GET	Äá»“ng bá»™ ticket theo thá»i gian tÆ°Æ¡ng á»©ng


â¸»

ğŸ§  Ghi chÃº triá»ƒn khai
	â€¢	CÃ¡c route backend dÃ¹ng logic giá»‘ng nhÆ° frontend, nhÆ°ng khÃ´ng cÃ³ giao diá»‡n, chá»‰ tráº£ JSON hoáº·c status code.
	â€¢	NÃªn log toÃ n bá»™ hoáº¡t Ä‘á»™ng cron (thÃ nh cÃ´ng/tháº¥t báº¡i) vÃ o báº£ng cron_log Ä‘á»ƒ kiá»ƒm tra/debug.
	â€¢	Gá»­i bÃ¡o cÃ¡o cÃ³ thá»ƒ thá»±c hiá»‡n song song qua Promise.all náº¿u cáº§n gá»­i nhiá»u nÆ¡i.

â¸»

âœ… Tá»•ng káº¿t

Há»‡ thá»‘ng sáº½ cÃ³ kháº£ nÄƒng:
	â€¢	Tá»± Ä‘á»™ng hÃ³a toÃ n bá»™ quy trÃ¬nh Ä‘á»“ng bá»™ ticket vÃ  sinh bÃ¡o cÃ¡o mÃ  khÃ´ng cáº§n thao tÃ¡c tay.
	â€¢	TÃ­ch há»£p Ä‘Æ°á»£c vá»›i há»‡ thá»‘ng ngoÃ i thÃ´ng qua Webhook API.
	â€¢	Váº«n Ä‘áº£m báº£o báº£o máº­t báº±ng .env, khÃ´ng log thÃ´ng tin API key.

â¸»

Náº¿u báº¡n muá»‘n mÃ¬nh táº¡o sáºµn file vercel.json vÃ  2 API route máº«u (/api/reports/cron vÃ  /api/hubspot/sync), mÃ¬nh cÃ³ thá»ƒ chuáº©n bá»‹ bá»™ khá»Ÿi Ä‘á»™ng ngay cho báº¡n.